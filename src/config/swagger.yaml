openapi: 3.0.0
info:
  title: Violation Management Service API
  description: API documentation for the Student Violation Management Service.
  version: 1.0.0
servers:
  - url: http://localhost:3004/api/v1
    description: Local development server

paths:
  /violations:
    get:
      summary: Get all violations
      tags: [Violations]
      parameters:
        - name: x-paging-offset
          in: header
          schema:
            type: integer
            default: 0
        - name: x-paging-limit
          in: header
          schema:
            type: integer
            default: 25
        - name: x-paging-search
          in: header
          schema:
            type: string
        - name: studentId
          in: query
          schema:
            type: string
        - name: status
          in: query
          schema:
            type: string
            enum: [PENDING, APPROVED_WALI, APPROVED_BK, REJECTED, APPEALED, APPEAL_APPROVED, APPEAL_REJECTED]
      responses:
        '200':
          description: A list of violations
    post:
      summary: Create a new violation
      tags: [Violations]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ViolationInput'
      responses:
        '201':
          description: Violation created

  /violations/{id}:
    get:
      summary: Get violation by ID
      tags: [Violations]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Violation details
    put:
      summary: Update a violation
      tags: [Violations]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ViolationInput'
      responses:
        '200':
          description: Violation updated
    delete:
      summary: Delete a violation
      tags: [Violations]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Violation deleted

  /violations/{id}/approve-walikelas:
    post:
      summary: Approve violation by Wali Kelas
      tags: [Approval]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                notes:
                  type: string
      responses:
        '200':
          description: Violation approved by Wali Kelas

  /violations/{id}/approve-bk:
    post:
      summary: Approve violation by BK
      tags: [Approval]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                notes:
                  type: string
      responses:
        '200':
          description: Violation approved by BK

  /violations/{id}/reject:
    post:
      summary: Reject violation
      tags: [Approval]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [reason]
              properties:
                reason:
                  type: string
      responses:
        '200':
          description: Violation rejected

  /violations/{id}/appeal:
    post:
      summary: Submit appeal for a violation
      tags: [Appeal]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [reason]
              properties:
                reason:
                  type: string
      responses:
        '200':
          description: Appeal submitted

  /violations/{id}/appeal/review:
    post:
      summary: Review an appeal
      tags: [Appeal]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [status]
              properties:
                status:
                  type: string
                  enum: [APPROVED, REJECTED]
                notes:
                  type: string
      responses:
        '200':
          description: Appeal reviewed

  /violations/stats/summary:
    get:
      summary: Get statistics summary
      tags: [Stats]
      responses:
        '200':
          description: Statistics summary

  /violations/stats/repeat-offenders:
    get:
      summary: Get repeat offenders
      tags: [Stats]
      responses:
        '200':
          description: List of repeat offenders

components:
  schemas:
    ViolationInput:
      type: object
      required: [studentId, categoryId, violationDate, description]
      properties:
        studentId:
          type: string
        categoryId:
          type: string
        violationDate:
          type: string
          format: date-time
        violationTime:
          type: string
          example: "08:00"
        description:
          type: string
        location:
          type: string
        witnessName:
          type: string
        witnessStatement:
          type: string
        evidenceUrls:
          type: array
          items:
            type: string
